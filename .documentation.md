# Video Generation API Documentation

## User-based Video Generation

The API now supports user-based video generation where each request must include a user ID and all jobs are tagged with the user ID for tracking and authorization.

### Changes Made

#### 1. Schema Updates
- Added `user_id` field to `GenerationRequest` schema (required)
- Added `user_id` field to `VideoInfo` schema for displaying user ownership
- User ID is stored in the database `video_generation_jobs` table

#### 2. API Endpoints

##### Submit Generation Job
- **Endpoint**: `POST /api/v1/generate`
- **Required**: `user_id` field in request body
- Jobs are now tagged with the user ID in the database

##### Get Job Status
- **Endpoint**: `GET /api/v1/job/{job_id}`
- **Optional**: `user_id` query parameter for user-specific authorization
- When user_id is provided, only returns jobs belonging to that user

##### List Completed Videos
- **Endpoint**: `GET /api/v1/videos`
- **Optional**: `user_id` query parameter to filter videos by user
- Returns all videos when no user_id specified
- Returns user-specific videos when user_id provided

#### 3. Task Processing
- Celery tasks now receive and log the user_id parameter
- User ID is included in all generation logging for tracking

### Usage Examples

#### Submit a video generation request
```json
POST /api/v1/generate
{
    "user_id": "user123",
    "prompt": "A beautiful sunset over mountains",
    "fps": 24
}
```

#### Get job status for a specific user
```
GET /api/v1/job/abc123?user_id=user123
```

#### List videos for a specific user
```
GET /api/v1/videos?user_id=user123
```

#### List all videos (admin view)
```
GET /api/v1/videos
```

### Database Schema
The `video_generation_jobs` table includes:
- `user_id` VARCHAR(100) - stores the user identifier
- All other existing fields remain unchanged

### Security Considerations
- User ID filtering is implemented at the database level
- Jobs can only be queried by their owner when user_id is specified
- No authentication is implemented - user_id is trusted from the request

### Backward Compatibility
- Existing job status queries without user_id still work (returns jobs regardless of user)
- Video listing without user_id returns all videos (admin view)
- Database migration handles existing NULL user_id values
